---
title: "v5q Benchmark Set Exclusion Regions"
date: '`r Sys.Date()`'
author: "ND Olson"
format:
  html:
    theme: flatly
    page-layout: full
    toc: true
    self-contained: true
editor: source
code-fold: true
execute:
  warning: false
---

TODO - add upset plot

```{r setup}
#| include: false
source(here::here("analysis/_notebook_setup.R"))
analysis_setup(
  load_plot_themes = TRUE,
  load_gt = TRUE
)
```

## Data Loading

```{r}
exclusion_intersect_tbl <- load_exclusion_metrics() %>%
  dplyr::filter(bench_version == "v5.0q")

if (nrow(exclusion_intersect_tbl) == 0) {
  stop("No v5.0q exclusion metrics found in results/exclusions.")
}
```

## Notes on Metrics

- `pct_of_exclusion` is the percent of each exclusion BED that overlaps the benchmark.
- `pct_of_dip` is the percent of diploid benchmark space represented by each exclusion overlap.

## Bases Removed by Exclusion

```{r}
exclusion_interset_gt_tbl <- exclusion_intersect_tbl %>%
  dplyr::select(ref, exclusions, bench_type, intersect_bp, pct_of_dip) %>%
  tidyr::pivot_wider(
    names_from = ref,
    values_from = c(intersect_bp, pct_of_dip)
  ) %>%
  dplyr::arrange(-intersect_bp_CHM13v2.0)

make_exclusion_tbl <- function(exclusion_tbl, table_title) {
  gt::gt(exclusion_tbl) %>%
    gt::fmt_integer(columns = contains("intersect_bp")) %>%
    gt::fmt_number(columns = contains("pct_of_dip"), decimals = 2) %>%
    gt::tab_spanner(label = "GRCh37", columns = contains("GRCh37")) %>%
    gt::tab_spanner(label = "GRCh38", columns = contains("GRCh38")) %>%
    gt::tab_spanner(label = "CHM13v2.0", columns = contains("CHM13v2.0")) %>%
    gt::tab_header(title = table_title) %>%
    gt::cols_align(columns = c("exclusions", "bench_type"), align = "right") %>%
    theme_gt_manuscript()
}
```

```{r}
exclusion_interset_gt_tbl %>%
  make_exclusion_tbl(table_title = "Benchmark Set Exclusions")
```
