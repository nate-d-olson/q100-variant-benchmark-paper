$schema: "https://json-schema.org/draft/2020-12/schema"

description: Configuration schema for Q100 variant benchmark pipeline

type: object

required:
  - benchmarksets
  - outputs

properties:
  benchmarksets:
    type: object
    description: Benchmark sets for analysis
    patternProperties:
      "^(v5q|v421|cmrg|v06|tr)_":
        type: object
        required:
          - vcf
        properties:
          ref:
            type: string
            description: Reference genome version (e.g., GRCh37, GRCh38)
          vcf:
            anyOf:
              - type: string
                description: Path to VCF file
                pattern: ".*\\.vcf\\.gz$"
              - type: object
                required:
                  - url
                anyOf:
                  - required: [md5]
                  - required: [sha256]
                properties:
                  url:
                    type: string
                    description: URL to VCF file
                  md5:
                    type: string
                    pattern: "^[a-f0-9]{32}$"
                    description: MD5 checksum of the VCF file
                  sha256:
                    type: string
                    pattern: "^[a-f0-9]{64}$"
                    description: SHA256 checksum of the VCF file
          bed:
            anyOf:
              - type: string
                pattern: ".*\\.bed(\\.gz)?$"
              - type: object
                required:
                  - url
                anyOf:
                  - required: [md5]
                  - required: [sha256]
                properties:
                  url:
                    type: string
                    description: URL to BED file
                  md5:
                    type: string
                    pattern: "^[a-f0-9]{32}$"
                    description: MD5 checksum of the BED file
                  sha256:
                    type: string
                    pattern: "^[a-f0-9]{64}$"
                    description: SHA256 checksum of the BED file
              - type: "null"
            description: Path to BED file (optional for pre-filtered benchmarks)
          dip_bed:
            type: object
            required:
              - url
            anyOf:
              - required: [md5]
              - required: [sha256]
            properties:
              url:
                type: string
                description: URL to dip.bed file
              md5:
                type: string
                pattern: "^[a-f0-9]{32}$"
                description: MD5 checksum
              sha256:
                type: string
                pattern: "^[a-f0-9]{64}$"
                description: SHA256 checksum
          exclusions:
            type: array
            description: Exclusion regions
            items:
              type: object
              required:
                - name
                - type
                - files
              properties:
                name:
                  type: string
                type:
                  enum: [single, pair]
                description:
                  type: string
                files:
                  type: array
                  items:
                    type: object
                    required:
                      - url
                    anyOf:
                      - required: [md5]
                      - required: [sha256]
                    properties:
                      url:
                        type: string
                      md5:
                        type: string
                        pattern: "^[a-f0-9]{32}$"
                      sha256:
                        type: string
                        pattern: "^[a-f0-9]{64}$"
    minProperties: 1

  references:
    type: object
    description: Reference files and other resources
    patternProperties:
      "^[a-zA-Z0-9_\\.]+$":
        type: object
        required:
          - url
        anyOf:
          - required: [md5]
          - required: [sha256]
        properties:
          url:
            type: string
            description: Remote URL for download
          md5:
            type: string
            pattern: "^[a-f0-9]{32}$"
            description: MD5 checksum
          sha256:
            type: string
            pattern: "^[a-f0-9]{64}$"
            description: SHA256 checksum
          autosome_bases:
            type: integer
            description: Total assembled bases in autosomes (chr1-22)
            minimum: 0
          autosome_sex_bases:
            type: integer
            description: Total assembled bases in autosomes and sex chromosomes (chr1-22, X, Y)
            minimum: 0
          stratifications:
            type: object
            description: Genome stratification BED files for this reference
            patternProperties:
              "^[A-Z0-9]+$":
                type: object
                required:
                  - url
                anyOf:
                  - required: [md5]
                  - required: [sha256]
                properties:
                  url:
                    type: string
                    description: URL to stratification BED file
                  description:
                    type: string
                    description: Description of this stratification
                  md5:
                    type: string
                    pattern: "^[a-f0-9]{32}$"
                    description: MD5 checksum
                  sha256:
                    type: string
                    pattern: "^[a-f0-9]{64}$"
                    description: SHA256 checksum

  stratifications:
    type: object
    description: Stratification BED files for variant context annotation
    patternProperties:
      "^[A-Z0-9]+$":
        type: object
        required:
          - url
        properties:
          url:
            type: string
            description: URL template with {ref} placeholder
          description:
            type: string
            description: Description of this stratification

  comparisons:
    type: object
    description: Benchmark comparison configurations
    patternProperties:
      "^[a-zA-Z0-9_]+$":
        type: object
        required:
          - type
          - new_benchmark
          - old_benchmark
          - ref
        properties:
          type:
            type: string
            enum: ["smvar", "stvar"]
            description: Type of variants (smvar or stvar)
          new_benchmark:
            type: string
            description: ID of the new benchmark set (from benchmarksets)
          old_benchmark:
            type: string
            description: ID of the old benchmark set (from benchmarksets)
          ref:
            type: string
            description: Reference genome ID (from references)

  outputs:
    type: object
    description: Output configuration
    required:
      - sv_len
      - rtg_stats_dir
      - subset_vcf_dir
    properties:
      sv_len:
        type: string
        description: SV length output filename
      rtg_stats_dir:
        type: string
        description: Directory for RTG stats outputs
      subset_vcf_dir:
        type: string
        description: Directory for subset VCF outputs
